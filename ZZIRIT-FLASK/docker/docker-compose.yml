version: '3.8'

services:
  zzirit-flask:
    build: .
    container_name: zzirit-flask-server
    ports:
      - "5100:5100"
    environment:
      - FLASK_ENV=production
      - PORT=5100
      - PYTHONPATH=/app
    env_file:
      - .env
    volumes:
      # ëª¨ë¸ ë° ë°ì´í„° ì˜ì†ì„±
      - ./CNN_model:/app/CNN_model
      - ./LLM_model:/app/LLM_model
      - ./model_all:/app/model_all
      - ./data:/app/data
      - ./logs:/app/logs
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5100/health"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    networks:
      - zzirit-network

  # í–¥í›„ í™•ì¥ìš© (DB, Redis ë“±)
  # database:
  #   image: mysql:8.0
  #   container_name: zzirit-mysql
  #   environment:
  #     MYSQL_ROOT_PASSWORD: rootpassword
  #     MYSQL_DATABASE: zzirit_db
  #   ports:
  #     - "3306:3306"
  #   volumes:
  #     - mysql_data:/var/lib/mysql
  #   networks:
  #     - zzirit-network

networks:
  zzirit-network:
    driver: bridge

volumes:
  mysql_data:

## 6. setup.sh ìˆ˜ì • (ê¶Œì¥)

```bash
#!/bin/bash

echo "ğŸš€ ZZIRIT-FLASK ì´ˆê¸° ì„¤ì • ì‹œì‘..."

# ìƒ‰ìƒ ì •ì˜
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
BLUE='\033[0;34m'
NC='\033[0m' # No Color

# ë¡œê·¸ í•¨ìˆ˜
log_info() {
    echo -e "${BLUE}[INFO]${NC} $1"
}

log_success() {
    echo -e "${GREEN}[SUCCESS]${NC} $1"
}

log_warning() {
    echo -e "${YELLOW}[WARNING]${NC} $1"
}

log_error() {
    echo -e "${RED}[ERROR]${NC} $1"
}

# 1. í•„ìš”í•œ í´ë” ìƒì„±
log_info "í•„ìš”í•œ í´ë” ìƒì„± ì¤‘..."
mkdir -p CNN_model LLM_model excel_data
mkdir -p data/{2022,2023,2024}
mkdir -p model_all logs
log_success "í´ë” ìƒì„± ì™„ë£Œ"

# 2. í™˜ê²½ ë³€ìˆ˜ íŒŒì¼ í™•ì¸/ìƒì„±
if [ ! -f .env ]; then
    if [ -f .env.example ]; then
        log_info ".env íŒŒì¼ ìƒì„± ì¤‘..."
        cp .env.example .env
        log_warning ".env íŒŒì¼ì„ ì—´ì–´ ì‹¤ì œ API í‚¤ì™€ ì„¤ì •ê°’ì„ ì…ë ¥í•´ì£¼ì„¸ìš”!"
        log_warning "íŠ¹íˆ GEMINI_API_KEYëŠ” í•„ìˆ˜ì…ë‹ˆë‹¤."
    else
        log_error ".env.example íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤. ë¨¼ì € .env.exampleì„ ìƒì„±í•´ì£¼ì„¸ìš”."
        exit 1
    fi
else
    log_success ".env íŒŒì¼ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."
fi

# 3. Python ê°€ìƒí™˜ê²½ í™•ì¸
if [ ! -d ".venv" ]; then
    log_info "Python ê°€ìƒí™˜ê²½ ìƒì„± ì¤‘..."
    python3 -m venv .venv
    log_success "ê°€ìƒí™˜ê²½ ìƒì„± ì™„ë£Œ"
else
    log_success "ê°€ìƒí™˜ê²½ì´ ì´ë¯¸ ì¡´ì¬í•©ë‹ˆë‹¤."
fi

# ê°€ìƒí™˜ê²½ í™œì„±í™”
log_info "ê°€ìƒí™˜ê²½ í™œì„±í™” ì¤‘..."
source .venv/bin/activate

# 4. íŒ¨í‚¤ì§€ ì„¤ì¹˜
log_info "Python íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì¤‘..."
pip install --upgrade pip
if pip install -r requirements.txt; then
    log_success "íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì™„ë£Œ"
else
    log_error "íŒ¨í‚¤ì§€ ì„¤ì¹˜ ì‹¤íŒ¨"
    exit 1
fi

# 5. DB ì—°ê²° í…ŒìŠ¤íŠ¸
log_info "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘..."
if python -c "
import sys
sys.path.append('.')
try:
    from services.db_handler import get_db_connection
    conn = get_db_connection()
    conn.close()
    print('âœ… DB ì—°ê²° ì„±ê³µ')
except Exception as e:
    print(f'âŒ DB ì—°ê²° ì‹¤íŒ¨: {e}')
    sys.exit(1)
"; then
    log_success "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì„±ê³µ"
else
    log_warning "ë°ì´í„°ë² ì´ìŠ¤ ì—°ê²° ì‹¤íŒ¨ - ê³„ì† ì§„í–‰í•˜ì§€ë§Œ DB ì„¤ì •ì„ í™•ì¸í•´ì£¼ì„¸ìš”"
fi

# 6. Gemini API í…ŒìŠ¤íŠ¸
log_info "Gemini API ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘..."
if python -c "
import sys
sys.path.append('.')
try:
    from gemini_handler import get_api_status
    status = get_api_status()
    if status.get('ready'):
        print('âœ… Gemini API ì—°ê²° ì„±ê³µ')
    else:
        print('âŒ Gemini API ì„¤ì • í•„ìš”')
        sys.exit(1)
except Exception as e:
    print(f'âŒ Gemini API í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨: {e}')
    sys.exit(1)
"; then
    log_success "Gemini API ì—°ê²° ì„±ê³µ"
else
    log_warning "Gemini API ì—°ê²° ì‹¤íŒ¨ - .env íŒŒì¼ì˜ GEMINI_API_KEYë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”"
fi

# 7. ì´ˆê¸° ë°ì´í„° ìƒì„± (ì„ íƒì )
read -p "ì´ˆê¸° í•™ìŠµ ë°ì´í„°ë¥¼ ìƒì„±í•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    log_info "ì´ˆê¸° ë°ì´í„° ìƒì„± ì¤‘... (ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)"
    if python data3.py --years 2022,2023,2024; then
        log_success "ì´ˆê¸° ë°ì´í„° ìƒì„± ì™„ë£Œ"
    else
        log_warning "ì´ˆê¸° ë°ì´í„° ìƒì„± ì‹¤íŒ¨ - ë‚˜ì¤‘ì— ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”"
    fi
else
    log_info "ì´ˆê¸° ë°ì´í„° ìƒì„±ì„ ê±´ë„ˆëœë‹ˆë‹¤"
fi

# 8. AI ëª¨ë¸ í•™ìŠµ (ì„ íƒì )
read -p "AI ëª¨ë¸ì„ í•™ìŠµí•˜ì‹œê² ìŠµë‹ˆê¹Œ? (y/N): " -n 1 -r
echo
if [[ $REPLY =~ ^[Yy]$ ]]; then
    log_info "AI ëª¨ë¸ í•™ìŠµ ì¤‘... (ì‹œê°„ì´ ë§¤ìš° ì˜¤ë˜ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)"
    if python ai-5-4.py --retrain --years 2023,2024; then
        log_success "AI ëª¨ë¸ í•™ìŠµ ì™„ë£Œ"
    else
        log_warning "AI ëª¨ë¸ í•™ìŠµ ì‹¤íŒ¨ - ë‚˜ì¤‘ì— ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰í•´ì£¼ì„¸ìš”"
    fi
else
    log_info "AI ëª¨ë¸ í•™ìŠµì„ ê±´ë„ˆëœë‹ˆë‹¤"
fi

# 9. ê¶Œí•œ ì„¤ì •
log_info "íŒŒì¼ ê¶Œí•œ ì„¤ì • ì¤‘..."
chmod +x setup.sh 2>/dev/null || true
chmod +x entrypoint.sh 2>/dev/null || true

# 10. ì„¤ì • ì™„ë£Œ ë©”ì‹œì§€
echo
echo "================================================================="
log_success "ZZIRIT-FLASK ì„¤ì • ì™„ë£Œ!"
echo "================================================================="
echo
echo "ğŸš€ ì„œë²„ ì‹œì‘ ë°©ë²•:"
echo "   ê°œë°œ ëª¨ë“œ: python app.py"
echo "   ìš´ì˜ ëª¨ë“œ: gunicorn -w 2 -k gthread --threads 4 -b 0.0.0.0:5100 app:app"
echo
echo "ğŸ³ Docker ì‹¤í–‰ ë°©ë²•:"
echo "   ë¹Œë“œ: docker build -t zzirit-flask ."
echo "   ì‹¤í–‰: docker run -p 5100:5100 --env-file .env zzirit-flask"
echo "   Compose: docker-compose up -d"
echo
echo "ğŸ“‹ í™•ì¸í•  ì—”ë“œí¬ì¸íŠ¸:"
echo "   ë©”ì¸: http://localhost:5100/"
echo "   í—¬ìŠ¤ì²´í¬: http://localhost:5100/health"
echo "   ë©”ì¸ ì±„íŒ…: http://localhost:5100/api/chat"
echo "   AI ì˜ˆì¸¡: http://localhost:5100/api/predict"
echo
log_warning "ì¤‘ìš”: .env íŒŒì¼ì˜ API í‚¤ë“¤ì„ ì‹¤ì œ ê°’ìœ¼ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”!"
echo "================================================================="